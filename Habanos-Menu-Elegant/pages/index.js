import fs from 'fs'
import path from 'path'
import {useState,useMemo,useEffect} from 'react'
import SearchBar from '../components/SearchBar'
import CategorySection from '../components/CategorySection'
export async function getStaticProps(){const filePath=path.join(process.cwd(),'data','menu.json');const raw=fs.readFileSync(filePath,'utf8');const menu=JSON.parse(raw);const categories=Object.keys(menu);return{props:{menu,categories}}}
export default function Home({menu,categories}){const [query,setQuery]=useState('');const filtered=useMemo(()=>{if(!query)return menu;const q=query.toLowerCase();const out={};for(const cat of Object.keys(menu)){const items=menu[cat].filter(it=>it.name.toLowerCase().includes(q));if(items.length) out[cat]=items}return out},[menu,query]);useEffect(()=>{const el=document.querySelector('main');if(el){el.style.opacity=0;el.style.transform='translateY(6px)';}setTimeout(()=>{if(el){el.style.transition='opacity 420ms ease-out, transform 420ms ease-out';el.style.opacity=1;el.style.transform='translateY(0)'}},80)},[]);return(<div className='page'><img src='/logo.png' className='watermark' aria-hidden='true'/><header><img src='/logo.png' className='logo' alt='Habanos Lounge'/><h1>HABANOS BAR</h1><p>Kenya's Premier Nightlife Destination</p><nav className='categories'>{categories.map(c=><button key={c} className='catBtn' onClick={()=>document.getElementById(c)?.scrollIntoView({behavior:'smooth',block:'start'})}>{c}</button>)}</nav></header><main><SearchBar query={query} setQuery={setQuery}/>{Object.keys(filtered).length===0?(<p style={{textAlign:'center',color:'var(--muted)'}}>No results</p>):Object.keys(filtered).map(cat=>(<CategorySection key={cat} name={cat} items={filtered[cat]}/>))}</main><footer><div>Habanos â€” {new Date().getFullYear()}</div><div className='qrWrap'><img src='/qr.png' alt='QR' style={{maxWidth:120}}/><div style={{fontSize:12,color:'var(--muted)'}}>Scan to view this menu online</div></div></footer></div>)}